import{c as De,a as Te,b as Be,j as e,f as I,u as U,q as Ve,P as Y,r as Ae,s as _e,t as fe}from"./ui-vendor-B31_whDI.js";import{r as x}from"./react-vendor-DpO94axI.js";import{S as Fe,V as Ie,u as Oe,M as Ke}from"./VideoCompressorSidebar-vp_cac6X.js";import{P as re,V as he,a as $e,D as He}from"./VideoPreview-C9zMGGDp.js";import{c as B,C as O,a as J,b as L,d as K,B as F,u as Je}from"./index-DM4jLR1H.js";import{S as ne,a as ie,b as ae,c as oe,d as le,e as Le}from"./switch-CIN1xx2Z.js";import{B as q}from"./badge-BUzB-rHp.js";import{C as W,W as Ue,E as Qe}from"./constants-D_o-vATH.js";import{S as We}from"./settings-CvJI5Lmp.js";import{F as R,f as Ye,a as ce,b as de,c as Ge,d as qe,e as me,g as ue,h as Xe,i as Ze,j as es}from"./icons-vendor-BrFV68z2.js";import{a as ss}from"./storage-NtJczFQT.js";import{Z as xe}from"./zap-Cwfbc4Dw.js";import{P as ts}from"./play-dJBESILs.js";import"./router-vendor-DUE0sPVx.js";import"./utils-vendor-CYC2HZ_g.js";import"./upload-BraCPvX2.js";import"./file-video-BrETnZz9.js";import"./query-vendor-DSb9RFWi.js";import"./clock-CIrfGpXT.js";var pe=["PageUp","PageDown"],ge=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],ve={"from-left":["Home","PageDown","ArrowDown","ArrowLeft"],"from-right":["Home","PageDown","ArrowDown","ArrowRight"],"from-bottom":["Home","PageDown","ArrowDown","ArrowLeft"],"from-top":["Home","PageDown","ArrowUp","ArrowLeft"]},$="Slider",[X,rs,ns]=De($),[Se,Js]=Te($,[ns]),[is,G]=Se($),we=x.forwardRef((s,t)=>{const{name:r,min:a=0,max:c=100,step:h=1,orientation:o="horizontal",disabled:m=!1,minStepsBetweenThumbs:i=0,defaultValue:f=[a],value:n,onValueChange:d=()=>{},onValueCommit:p=()=>{},inverted:v=!1,form:S,...j}=s,b=x.useRef(new Set),y=x.useRef(0),l=o==="horizontal"?as:os,[u=[],g]=Be({prop:n,defaultProp:f,onChange:N=>{var _;(_=[...b.current][y.current])==null||_.focus(),d(N)}}),C=x.useRef(u);function w(N){const z=us(u,N);P(N,z)}function D(N){P(N,y.current)}function A(){const N=C.current[y.current];u[y.current]!==N&&p(u)}function P(N,z,{commit:_}={commit:!1}){const Q=ps(h),M=gs(Math.round((N-a)/h)*h+a,Q),E=fe(M,[a,c]);g((k=[])=>{const T=ds(k,E,z);if(hs(T,i*h)){y.current=T.indexOf(E);const te=String(T)!==String(k);return te&&_&&p(T),te?T:k}else return k})}return e.jsx(is,{scope:s.__scopeSlider,name:r,disabled:m,min:a,max:c,valueIndexToChangeRef:y,thumbs:b.current,values:u,orientation:o,form:S,children:e.jsx(X.Provider,{scope:s.__scopeSlider,children:e.jsx(X.Slot,{scope:s.__scopeSlider,children:e.jsx(l,{"aria-disabled":m,"data-disabled":m?"":void 0,...j,ref:t,onPointerDown:I(j.onPointerDown,()=>{m||(C.current=u)}),min:a,max:c,inverted:v,onSlideStart:m?void 0:w,onSlideMove:m?void 0:D,onSlideEnd:m?void 0:A,onHomeKeyDown:()=>!m&&P(a,0,{commit:!0}),onEndKeyDown:()=>!m&&P(c,u.length-1,{commit:!0}),onStepKeyDown:({event:N,direction:z})=>{if(!m){const M=pe.includes(N.key)||N.shiftKey&&ge.includes(N.key)?10:1,E=y.current,k=u[E],T=h*M*z;P(k+T,E,{commit:!0})}}})})})})});we.displayName=$;var[Ne,ye]=Se($,{startEdge:"left",endEdge:"right",size:"width",direction:1}),as=x.forwardRef((s,t)=>{const{min:r,max:a,dir:c,inverted:h,onSlideStart:o,onSlideMove:m,onSlideEnd:i,onStepKeyDown:f,...n}=s,[d,p]=x.useState(null),v=U(t,l=>p(l)),S=x.useRef(),j=Ve(c),b=j==="ltr",y=b&&!h||!b&&h;function V(l){const u=S.current||d.getBoundingClientRect(),g=[0,u.width],w=se(g,y?[r,a]:[a,r]);return S.current=u,w(l-u.left)}return e.jsx(Ne,{scope:s.__scopeSlider,startEdge:y?"left":"right",endEdge:y?"right":"left",direction:y?1:-1,size:"width",children:e.jsx(je,{dir:j,"data-orientation":"horizontal",...n,ref:v,style:{...n.style,"--radix-slider-thumb-transform":"translateX(-50%)"},onSlideStart:l=>{const u=V(l.clientX);o==null||o(u)},onSlideMove:l=>{const u=V(l.clientX);m==null||m(u)},onSlideEnd:()=>{S.current=void 0,i==null||i()},onStepKeyDown:l=>{const g=ve[y?"from-left":"from-right"].includes(l.key);f==null||f({event:l,direction:g?-1:1})}})})}),os=x.forwardRef((s,t)=>{const{min:r,max:a,inverted:c,onSlideStart:h,onSlideMove:o,onSlideEnd:m,onStepKeyDown:i,...f}=s,n=x.useRef(null),d=U(t,n),p=x.useRef(),v=!c;function S(j){const b=p.current||n.current.getBoundingClientRect(),y=[0,b.height],l=se(y,v?[a,r]:[r,a]);return p.current=b,l(j-b.top)}return e.jsx(Ne,{scope:s.__scopeSlider,startEdge:v?"bottom":"top",endEdge:v?"top":"bottom",size:"height",direction:v?1:-1,children:e.jsx(je,{"data-orientation":"vertical",...f,ref:d,style:{...f.style,"--radix-slider-thumb-transform":"translateY(50%)"},onSlideStart:j=>{const b=S(j.clientY);h==null||h(b)},onSlideMove:j=>{const b=S(j.clientY);o==null||o(b)},onSlideEnd:()=>{p.current=void 0,m==null||m()},onStepKeyDown:j=>{const y=ve[v?"from-bottom":"from-top"].includes(j.key);i==null||i({event:j,direction:y?-1:1})}})})}),je=x.forwardRef((s,t)=>{const{__scopeSlider:r,onSlideStart:a,onSlideMove:c,onSlideEnd:h,onHomeKeyDown:o,onEndKeyDown:m,onStepKeyDown:i,...f}=s,n=G($,r);return e.jsx(Y.span,{...f,ref:t,onKeyDown:I(s.onKeyDown,d=>{d.key==="Home"?(o(d),d.preventDefault()):d.key==="End"?(m(d),d.preventDefault()):pe.concat(ge).includes(d.key)&&(i(d),d.preventDefault())}),onPointerDown:I(s.onPointerDown,d=>{const p=d.target;p.setPointerCapture(d.pointerId),d.preventDefault(),n.thumbs.has(p)?p.focus():a(d)}),onPointerMove:I(s.onPointerMove,d=>{d.target.hasPointerCapture(d.pointerId)&&c(d)}),onPointerUp:I(s.onPointerUp,d=>{const p=d.target;p.hasPointerCapture(d.pointerId)&&(p.releasePointerCapture(d.pointerId),h(d))})})}),be="SliderTrack",Ce=x.forwardRef((s,t)=>{const{__scopeSlider:r,...a}=s,c=G(be,r);return e.jsx(Y.span,{"data-disabled":c.disabled?"":void 0,"data-orientation":c.orientation,...a,ref:t})});Ce.displayName=be;var Z="SliderRange",Pe=x.forwardRef((s,t)=>{const{__scopeSlider:r,...a}=s,c=G(Z,r),h=ye(Z,r),o=x.useRef(null),m=U(t,o),i=c.values.length,f=c.values.map(p=>Ee(p,c.min,c.max)),n=i>1?Math.min(...f):0,d=100-Math.max(...f);return e.jsx(Y.span,{"data-orientation":c.orientation,"data-disabled":c.disabled?"":void 0,...a,ref:m,style:{...s.style,[h.startEdge]:n+"%",[h.endEdge]:d+"%"}})});Pe.displayName=Z;var ee="SliderThumb",Re=x.forwardRef((s,t)=>{const r=rs(s.__scopeSlider),[a,c]=x.useState(null),h=U(t,m=>c(m)),o=x.useMemo(()=>a?r().findIndex(m=>m.ref.current===a):-1,[r,a]);return e.jsx(ls,{...s,ref:h,index:o})}),ls=x.forwardRef((s,t)=>{const{__scopeSlider:r,index:a,name:c,...h}=s,o=G(ee,r),m=ye(ee,r),[i,f]=x.useState(null),n=U(t,V=>f(V)),d=i?o.form||!!i.closest("form"):!0,p=Ae(i),v=o.values[a],S=v===void 0?0:Ee(v,o.min,o.max),j=ms(a,o.values.length),b=p==null?void 0:p[m.size],y=b?xs(b,S,m.direction):0;return x.useEffect(()=>{if(i)return o.thumbs.add(i),()=>{o.thumbs.delete(i)}},[i,o.thumbs]),e.jsxs("span",{style:{transform:"var(--radix-slider-thumb-transform)",position:"absolute",[m.startEdge]:`calc(${S}% + ${y}px)`},children:[e.jsx(X.ItemSlot,{scope:s.__scopeSlider,children:e.jsx(Y.span,{role:"slider","aria-label":s["aria-label"]||j,"aria-valuemin":o.min,"aria-valuenow":v,"aria-valuemax":o.max,"aria-orientation":o.orientation,"data-orientation":o.orientation,"data-disabled":o.disabled?"":void 0,tabIndex:o.disabled?void 0:0,...h,ref:n,style:v===void 0?{display:"none"}:s.style,onFocus:I(s.onFocus,()=>{o.valueIndexToChangeRef.current=a})})}),d&&e.jsx(cs,{name:c??(o.name?o.name+(o.values.length>1?"[]":""):void 0),form:o.form,value:v},a)]})});Re.displayName=ee;var cs=s=>{const{value:t,...r}=s,a=x.useRef(null),c=_e(t);return x.useEffect(()=>{const h=a.current,o=window.HTMLInputElement.prototype,i=Object.getOwnPropertyDescriptor(o,"value").set;if(c!==t&&i){const f=new Event("input",{bubbles:!0});i.call(h,t),h.dispatchEvent(f)}},[c,t]),e.jsx("input",{style:{display:"none"},...r,ref:a,defaultValue:t})};function ds(s=[],t,r){const a=[...s];return a[r]=t,a.sort((c,h)=>c-h)}function Ee(s,t,r){const h=100/(r-t)*(s-t);return fe(h,[0,100])}function ms(s,t){return t>2?`Value ${s+1} of ${t}`:t===2?["Minimum","Maximum"][s]:void 0}function us(s,t){if(s.length===1)return 0;const r=s.map(c=>Math.abs(c-t)),a=Math.min(...r);return r.indexOf(a)}function xs(s,t,r){const a=s/2,h=se([0,50],[0,a]);return(a-h(t)*r)*r}function fs(s){return s.slice(0,-1).map((t,r)=>s[r+1]-t)}function hs(s,t){if(t>0){const r=fs(s);return Math.min(...r)>=t}return!0}function se(s,t){return r=>{if(s[0]===s[1]||t[0]===t[1])return t[0];const a=(t[1]-t[0])/(s[1]-s[0]);return t[0]+a*(r-s[0])}}function ps(s){return(String(s).split(".")[1]||"").length}function gs(s,t){const r=Math.pow(10,t);return Math.round(s*r)/r}var ke=we,vs=Ce,Ss=Pe,ws=Re;const ze=x.forwardRef(({className:s,...t},r)=>e.jsxs(ke,{ref:r,className:B("relative flex w-full touch-none select-none items-center",s),...t,children:[e.jsx(vs,{className:"relative h-2 w-full grow overflow-hidden rounded-full bg-secondary",children:e.jsx(Ss,{className:"absolute h-full bg-primary"})}),e.jsx(ws,{className:"block h-5 w-5 rounded-full border-2 border-primary bg-background ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50"})]}));ze.displayName=ke.displayName;function Ns({selectedPreset:s,onPresetChange:t,customSettings:r,onCustomSettingsChange:a}){const[c,h]=x.useState(!1),o=i=>{if(t(i),i!=="custom"){const f=W.find(n=>n.id===i);f&&a({crf:f.crf,preset:f.preset,scale:f.scale,preserveQuality:r.preserveQuality})}},m=W.find(i=>i.id===s);return e.jsxs(O,{children:[e.jsx(J,{children:e.jsxs(L,{className:"flex items-center gap-2",children:[e.jsx(We,{className:"w-5 h-5 text-video-primary"}),"Compression Settings"]})}),e.jsxs(K,{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium mb-3",children:"Choose a preset:"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-3",children:W.map(i=>{const f=i.icon,n=s===i.id;return e.jsxs(F,{variant:n?"default":"outline",onClick:()=>o(i.id),className:B("h-auto p-3 flex flex-col items-center gap-2 transition-smooth",n&&"bg-video-primary hover:bg-video-primary-dark text-white"),children:[e.jsx("div",{className:B("w-8 h-8 rounded-full flex items-center justify-center",n?"bg-white/20":i.color),children:e.jsx(f,{className:B("w-4 h-4","text-white")})}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"font-medium text-xs",children:i.name}),e.jsx("div",{className:"text-xs opacity-70",children:i.estimatedReduction})]})]},i.id)})})]}),m&&e.jsx("div",{className:"p-3 bg-video-secondary/50 rounded-lg border",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:B("w-10 h-10 rounded-full flex items-center justify-center",m.color),children:e.jsx(m.icon,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("h4",{className:"font-medium",children:m.name}),e.jsxs(q,{variant:"secondary",className:"text-xs",children:[m.estimatedReduction," reduction"]})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:m.description})]})]})}),s==="custom"&&e.jsxs("div",{className:"space-y-4 p-4 bg-video-secondary/30 rounded-lg border",children:[e.jsxs("h4",{className:"font-medium flex items-center gap-2",children:[e.jsx(Ue,{className:"w-4 h-4 text-video-accent"}),"Custom Settings"]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("label",{className:"text-sm font-medium",children:["Quality (CRF): ",r.crf]}),e.jsx("span",{className:"text-xs text-muted-foreground",children:r.crf<=15?"Excellent":r.crf<=23?"Good":r.crf<=30?"Average":"Low"})]}),e.jsx(ze,{value:[r.crf],onValueChange:i=>a({...r,crf:i[0]}),min:0,max:51,step:1,className:"w-full"}),e.jsxs("div",{className:"flex justify-between text-xs text-muted-foreground",children:[e.jsx("span",{children:"Best Quality (0)"}),e.jsx("span",{children:"Smallest Size (51)"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Encoding Speed:"}),e.jsxs(ne,{value:r.preset,onValueChange:i=>a({...r,preset:i}),children:[e.jsx(ie,{children:e.jsx(ae,{})}),e.jsx(oe,{children:ENCODING_PRESETS.map(i=>e.jsx(le,{value:i.value,children:e.jsxs("div",{className:"flex justify-between items-center w-full",children:[e.jsx("span",{children:i.label}),e.jsxs("div",{className:"text-xs text-muted-foreground ml-4",children:["Speed: ",i.speed," • Quality: ",i.quality]})]})},i.value))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Resolution Scaling:"}),e.jsxs(ne,{value:r.scale.toString(),onValueChange:i=>a({...r,scale:parseInt(i)}),children:[e.jsx(ie,{children:e.jsx(ae,{})}),e.jsx(oe,{children:RESOLUTION_OPTIONS.map(i=>e.jsx(le,{value:i.value.toString(),children:i.label},i.value))})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs(F,{variant:"ghost",size:"sm",onClick:()=>h(!c),className:"text-sm",children:[c?"Hide":"Show"," Advanced Options"]}),c&&e.jsx("div",{className:"space-y-3 p-3 bg-muted/30 rounded-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Preserve Quality"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Skip compression for already compressed videos"})]}),e.jsx(Le,{checked:r.preserveQuality,onCheckedChange:i=>a({...r,preserveQuality:i})})]})})]})]})]})}function H(s){if(!s||s===0||!isFinite(s))return"0 Bytes";const t=1024,r=["Bytes","KB","MB","GB"],a=Math.floor(Math.log(s)/Math.log(t));return parseFloat((s/Math.pow(t,a)).toFixed(1))+" "+r[a]}function Me(s){return s<60?`${s}s`:s<3600?`${Math.floor(s/60)}m ${s%60}s`:`${Math.floor(s/3600)}h ${Math.floor(s%3600/60)}m`}function ys(s){if(!s.startTime||s.progress===0)return"Calculating...";const t=(Date.now()-s.startTime)/1e3,r=s.progress/t,a=(100-s.progress)/r;return!isFinite(a)||a<=0?"Almost done...":Me(Math.round(a))}const js=x.memo(({jobs:s,onCancelJob:t,onDownload:r,onRetry:a,className:c})=>{const h=x.useMemo(()=>{const n=s.filter(S=>S.status==="processing"||S.status==="waiting"),d=s.filter(S=>S.status==="completed"),p=s.filter(S=>S.status==="error"),v=s.length>0?s.reduce((S,j)=>S+j.progress,0)/s.length:0;return{activeJobs:n,completedJobs:d,errorJobs:p,totalProgress:v}},[s]),{activeJobs:o,completedJobs:m,errorJobs:i,totalProgress:f}=h;return s.length===0?null:e.jsxs("div",{className:B("space-y-4",c),children:[e.jsxs(O,{children:[e.jsx(J,{className:"pb-3",children:e.jsxs(L,{className:"text-lg flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(R,{icon:Ye,className:"text-video-primary"}),"Compression Progress"]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsxs(q,{variant:"secondary",children:[m.length,"/",s.length," Complete"]}),i.length>0&&e.jsxs(q,{variant:"destructive",children:[i.length," Error",i.length>1?"s":""]})]})]})}),e.jsx(K,{children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Overall Progress"}),e.jsxs("span",{children:[Math.round(f),"%"]})]}),e.jsx(re,{value:f,className:"h-2"}),o.length>0&&e.jsxs("div",{className:"flex items-center gap-4 text-xs text-muted-foreground",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(R,{icon:ce}),o.length," processing"]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(R,{icon:de}),H(s.reduce((n,d)=>n+d.originalSize,0))," total"]})]})]})})]}),e.jsx("div",{className:"space-y-4",children:s.map(n=>{const d=n.status==="processing",p=n.status==="completed",v=n.status==="error",S=n.status==="waiting";return e.jsxs("div",{className:"space-y-3",children:[e.jsx(O,{className:B("transition-smooth",d&&"border-video-primary shadow-md",p&&"border-video-success",v&&"border-video-danger"),children:e.jsx(K,{className:"p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsxs("div",{className:B("w-10 h-10 rounded-lg flex items-center justify-center flex-shrink-0",p?"bg-video-success text-white":v?"bg-video-danger text-white":d?"bg-video-primary text-white animate-pulse-glow":"bg-video-secondary text-muted-foreground"),children:[d&&e.jsx(R,{icon:Ge,className:"animate-spin"}),p&&e.jsx(R,{icon:qe}),S&&e.jsx(R,{icon:ce}),v&&e.jsx(R,{icon:me}),n.status==="cancelled"&&e.jsx(R,{icon:ue})]}),e.jsxs("div",{className:"flex-1 min-w-0 space-y-2",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("h4",{className:"font-medium truncate text-sm lg:text-base",children:n.file.name}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2 text-xs text-muted-foreground",children:[e.jsxs("span",{children:["Original: ",H(n.originalSize)]}),e.jsx("span",{children:"•"}),e.jsxs("span",{children:[n.settings.preset," preset"]}),n.compressedSize&&e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"•"}),e.jsxs("span",{className:"text-video-success",children:["Compressed: ",H(n.compressedSize)," (",Math.round(n.originalSize>0?(n.originalSize-n.compressedSize)/n.originalSize*100:0),"% saved)"]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-1 flex-shrink-0",children:[p&&e.jsxs(F,{size:"sm",onClick:()=>r(n.id),className:"h-8 px-3 bg-yellow-500 hover:bg-yellow-600 text-white text-sm",children:[e.jsx(R,{icon:Xe,className:"mr-1"}),e.jsx("span",{className:"hidden sm:inline",children:"Download"})]}),v&&e.jsxs(F,{size:"sm",variant:"outline",onClick:()=>a(n.id),className:"h-8 px-3",children:[e.jsx(R,{icon:Ze,className:"mr-1"}),"Retry"]}),(d||S)&&e.jsx(F,{size:"sm",variant:"outline",onClick:()=>t(n.id),className:"h-8 px-3 text-video-danger hover:text-video-danger hover:bg-video-danger/10",children:e.jsx(R,{icon:ue})})]})]}),!v&&e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex justify-between text-xs",children:[e.jsx("span",{className:"text-muted-foreground",children:S?"Waiting...":p?"Completed":`${Math.round(n.progress)}%`}),d&&e.jsxs("span",{className:"text-muted-foreground",children:["ETA: ",ys(n)]}),p&&n.startTime&&n.endTime&&e.jsx("span",{className:"text-muted-foreground",children:Me(Math.floor((n.endTime-n.startTime)/1e3))})]}),e.jsx(re,{value:n.progress,className:B("h-1.5",p&&"[&>div]:bg-video-success")})]}),v&&n.error&&e.jsxs("div",{className:"p-2 bg-video-danger/10 border border-video-danger/20 rounded text-xs text-video-danger flex items-center gap-2",children:[e.jsx(R,{icon:me}),n.error]}),p&&n.compressedSize&&e.jsxs("div",{className:"flex items-center gap-4 text-xs text-muted-foreground",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(R,{icon:de}),H(n.originalSize)," → ",H(n.compressedSize)]}),e.jsxs("div",{className:"flex items-center gap-1 text-video-success",children:[e.jsx(R,{icon:es}),Math.round(n.originalSize>0?(n.originalSize-n.compressedSize)/n.originalSize*100:0),"% smaller"]})]})]})]})})}),p&&n.outputBlob&&e.jsx(he,{originalFile:n.file,compressedBlob:n.outputBlob,originalSize:n.originalSize,compressedSize:n.compressedSize,onDownload:()=>r(n.id)})]},n.id)})})]})});function bs(){const{toggleSidebar:s}=Oe(),{toast:t}=Je(),[r,a]=x.useState([]),[c,h]=x.useState("balanced"),[o,m]=x.useState({crf:25,preset:"medium",scale:100,preserveQuality:!1}),[i,f]=x.useState([]),[n,d]=x.useState(!1),p=x.useCallback(l=>{a(u=>[...u,...l]),t({title:"Files Added",description:`${l.length} file${l.length>1?"s":""} added to compression queue.`})},[t]),v=x.useCallback(async l=>{f(g=>g.map(C=>C.id===l?{...C,status:"processing",startTime:Date.now()}:C));const u=setInterval(()=>{f(g=>g.map(w=>{if(w.id===l&&w.status==="processing"){const D=Math.min(w.progress+Math.random()*10,100);return D>=100?(clearInterval(u),(async()=>{try{if(!w.file)throw new Error("No file found for this job.");const A=Math.random()*.4+.2,P=Math.floor(w.originalSize*(1-A));let N,z=0;try{const M=await w.file.arrayBuffer(),E=new Uint8Array(M),k=Math.max(P,1024*1024),T=E.slice(0,k);N=new Blob([T],{type:w.file.type}),z=N.size}catch(M){if(M instanceof Error&&M.name==="NotReadableError"){t({title:"File Read Error",description:"The selected file could not be read. Please re-upload the file and try again.",variant:"destructive"}),f(E=>E.map(k=>k.id===l?{...k,status:"error",error:"File could not be read"}:k));return}else throw M}const _=Math.min(Math.max(A,.1),.9),Q={...w,status:"completed",progress:100,endTime:Date.now(),compressedSize:z,outputBlob:N};f(M=>M.map(E=>E.id===l?Q:E)),ss({fileName:w.file.name,originalSize:w.originalSize,compressedSize:z,compressionRatio:_*100,preset:w.settings.preset,duration:"Unknown",status:"completed",fileType:w.file.type,settings:w.settings})}catch{t({title:"Compression Failed",description:"An error occurred during compression. Please try again.",variant:"destructive"}),f(P=>P.map(N=>N.id===l?{...N,status:"error",error:"Compression failed"}:N))}})(),{...w,progress:100}):{...w,progress:D}}return w}))},200);return u},[t]),S=x.useCallback(l=>{const u=[];return l.forEach((g,C)=>{const w=setTimeout(()=>{v(g.id).then(D=>{D&&u.push(D)})},C*1e3);u.push(w)}),()=>{u.forEach(g=>{clearTimeout(g),clearInterval(g)})}},[v]),j=x.useCallback(()=>{if(r.length===0){t({title:"No Files Selected",description:"Please select video files to compress.",variant:"destructive"});return}const l=W.find(C=>C.id===c),u=c==="custom"?o:{crf:(l==null?void 0:l.crf)||25,preset:(l==null?void 0:l.preset)||"medium",scale:(l==null?void 0:l.scale)||100,preserveQuality:o.preserveQuality},g=r.map((C,w)=>({id:`job-${Date.now()}-${w}`,file:C,status:"waiting",progress:0,originalSize:C.size,settings:{preset:c,crf:u.crf,scale:u.scale}}));f(C=>[...C,...g]),a([]),d(!0),S(g),t({title:"Compression Started",description:`Started compressing ${g.length} file${g.length>1?"s":""}.`})},[r,c,o,t,S]),b=x.useCallback(l=>{f(u=>u.map(g=>g.id===l?{...g,status:"cancelled"}:g)),t({title:"Job Cancelled",description:"Compression job has been cancelled."})},[t]),y=x.useCallback(l=>{const u=i.find(g=>g.id===l);if(u!=null&&u.outputBlob)try{const g=u.file.name,C=g.substring(0,g.lastIndexOf(".")),w=g.substring(g.lastIndexOf(".")),D=`${C}_compressed${w}`,A=URL.createObjectURL(u.outputBlob),P=document.createElement("a");P.href=A,P.download=D,P.style.display="none",document.body.appendChild(P),P.click(),setTimeout(()=>{document.body.removeChild(P),URL.revokeObjectURL(A)},100),t({title:"Download Started",description:`Downloading compressed ${D}`})}catch{t({title:"Download Failed",description:"Unable to download the compressed file. Please try again.",variant:"destructive"})}else t({title:"Download Failed",description:"No compressed file available for download.",variant:"destructive"})},[i,t]),V=x.useCallback(l=>{f(u=>u.map(g=>g.id===l?{...g,status:"waiting",progress:0,error:void 0}:g)),setTimeout(()=>{v(l)},1e3),t({title:"Retrying",description:"Retrying compression job..."})},[v,t]);return e.jsxs("div",{className:"flex-1 p-4 lg:p-6 space-y-6 overflow-x-hidden",children:[e.jsxs("div",{className:"sticky top-0 z-10 bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/60 border-b pb-2 lg:pb-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Video Compressor"}),e.jsx("p",{className:"text-muted-foreground",children:"Compress your videos to save space while maintaining quality"})]}),e.jsx(F,{variant:"outline",size:"sm",onClick:s,className:"lg:hidden",children:e.jsx(Ke,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-4 mt-4",children:[e.jsxs(F,{onClick:j,disabled:r.length===0||n,size:"lg",className:r.length>0?"bg-red-500 hover:bg-red-600":"",children:[e.jsx(xe,{className:"w-4 h-4 mr-2"}),"Start Compression"]}),e.jsx(F,{variant:"outline",onClick:()=>{a([]),f([])},disabled:r.length===0&&i.length===0,children:"Clear Files"}),e.jsxs("span",{className:"ml-2 text-muted-foreground text-sm",children:[r.length," file",r.length===1?"":"s"," selected"]})]})]}),e.jsxs("div",{className:"grid gap-6 lg:grid-cols-4",children:[e.jsxs("div",{className:"lg:col-span-3 space-y-6",children:[e.jsxs(O,{children:[e.jsx(J,{children:e.jsxs(L,{className:"flex items-center gap-2",children:[e.jsx(ts,{className:"w-5 h-5"}),"Upload Videos"]})}),e.jsx(K,{children:e.jsx(He,{onFilesSelected:p})})]}),r.length>0&&e.jsxs(O,{children:[e.jsx(J,{children:e.jsxs(L,{className:"flex items-center gap-2",children:[e.jsx(Qe,{className:"w-5 h-5"}),"Selected Files Preview"]})}),e.jsx(K,{children:e.jsx("div",{className:"space-y-4",children:r.map((l,u)=>e.jsxs("div",{className:"border rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"font-medium text-xs lg:text-base truncate max-w-[50%]",children:l.name}),e.jsxs("span",{className:"text-xs lg:text-sm text-muted-foreground flex-shrink-0",children:[(l.size/(1024*1024)).toFixed(2)," MB"]})]}),e.jsx(he,{originalFile:l,originalSize:l.size,onDownload:()=>{}})]},u))})})]}),e.jsx(js,{jobs:i,onCancelJob:b,onDownload:y,onRetry:V})]}),e.jsx("div",{className:"space-y-6",children:e.jsxs(O,{children:[e.jsx(J,{children:e.jsxs(L,{className:"flex items-center gap-2",children:[e.jsx(xe,{className:"w-5 h-5"}),"Compression Settings"]})}),e.jsx(K,{children:e.jsx(Ns,{selectedPreset:c,onPresetChange:h,customSettings:o,onCustomSettingsChange:m})})]})})]})]})}function Ls(){return e.jsxs(Fe,{children:[e.jsx($e,{}),e.jsxs("div",{className:"flex min-h-screen w-full bg-background",children:[e.jsx(Ie,{}),e.jsx(bs,{})]})]})}export{Ls as default};
