import{j as e}from"./ui-vendor-B31_whDI.js";import{r as c}from"./react-vendor-DpO94axI.js";import{S as q,V as H,u as Z,M as G}from"./VideoCompressorSidebar-vp_cac6X.js";import{b as K,D as Q,V as B,P as X,C as Y}from"./VideoPreview-C9zMGGDp.js";import{u as ee,B as x,C as w,a as y,b as C,d as j,T as g}from"./index-DM4jLR1H.js";import{B as b}from"./badge-BUzB-rHp.js";import{W as R,E as M}from"./constants-D_o-vATH.js";import{F as se}from"./file-video-BrETnZz9.js";import{D as ae}from"./download-CqxjUFrq.js";import{R as D}from"./rotate-ccw-C3-GWWE3.js";import{C as re}from"./clock-CIrfGpXT.js";import"./router-vendor-DUE0sPVx.js";import"./utils-vendor-CYC2HZ_g.js";import"./upload-BraCPvX2.js";import"./icons-vendor-BrFV68z2.js";import"./query-vendor-DSb9RFWi.js";import"./zap-Cwfbc4Dw.js";function te(){const{toggleSidebar:P}=Z(),{toast:n}=ee(),[m,k]=c.useState([]),[p,u]=c.useState([]),[E,I]=c.useState(!1),[S,$]=c.useState("metadata"),V=c.useCallback(s=>{k(r=>[...r,...s]),n({title:"Files Added",description:`${s.length} file${s.length>1?"s":""} added to repair queue.`})},[n]),z=c.useCallback(async s=>(await new Promise(a=>setTimeout(a,500)),{durationMismatch:Math.random()>.5,metadataCorruption:Math.random()>.7,containerIssues:Math.random()>.6,playbackIssues:Math.random()>.4}),[]),f=c.useCallback(async s=>{u(l=>l.map(d=>d.id===s?{...d,status:"analyzing",startTime:Date.now()}:d));const r=p.find(l=>l.id===s);if(!r)return;const a=await z(r.file);u(l=>l.map(d=>d.id===s?{...d,status:"repairing",issues:a,progress:10}:d));const t=setInterval(()=>{u(l=>l.map(i=>{if(i.id===s&&i.status==="repairing"){const o=Math.min(i.progress+Math.random()*40+20,100);return o>=100?(clearInterval(t),setTimeout(async()=>{try{const v=await i.file.arrayBuffer(),N=new Blob([v],{type:i.file.type}),h={...i,status:"completed",progress:100,endTime:Date.now(),repairedSize:N.size,outputBlob:N};u(_=>_.map(T=>T.id===s?h:T)),n({title:"Repair Completed",description:`Successfully repaired ${i.file.name}`})}catch{u(N=>N.map(h=>h.id===s?{...h,status:"error",error:"Repair failed"}:h)),n({title:"Repair Failed",description:"An error occurred during repair. Please try again.",variant:"destructive"})}},300),{...i,progress:100}):{...i,progress:o}}return i}))},100);return t},[p,z,n]),U=c.useCallback(()=>{if(m.length===0){n({title:"No Files Selected",description:"Please select video files to repair.",variant:"destructive"});return}const s=m.map((a,t)=>({id:`repair-${Date.now()}-${t}`,file:a,status:"waiting",progress:0,originalSize:a.size,issues:{durationMismatch:!1,metadataCorruption:!1,containerIssues:!1,playbackIssues:!1},repairType:S}));u(a=>[...a,...s]),k([]),I(!0);const r=[];return s.forEach((a,t)=>{const l=setTimeout(()=>{f(a.id)},t*2e3);r.push(l)}),()=>{r.forEach(a=>clearTimeout(a))}},[m,S,n,f]),J=c.useCallback(s=>{u(r=>r.map(a=>a.id===s?{...a,status:"cancelled"}:a)),n({title:"Job Cancelled",description:"Repair job has been cancelled."})},[n]),F=c.useCallback(s=>{const r=p.find(a=>a.id===s);if(r!=null&&r.outputBlob)try{const a=r.file.name,t=a.substring(0,a.lastIndexOf(".")),l=a.substring(a.lastIndexOf(".")),d=`${t}_repaired${l}`,i=URL.createObjectURL(r.outputBlob),o=document.createElement("a");o.href=i,o.download=d,o.style.display="none",document.body.appendChild(o),o.click();const v=setTimeout(()=>{document.body.removeChild(o),URL.revokeObjectURL(i)},100);return()=>{clearTimeout(v),document.body.contains(o)&&document.body.removeChild(o),URL.revokeObjectURL(i)}}catch{n({title:"Download Failed",description:"Unable to download the repaired file. Please try again.",variant:"destructive"})}},[p,n]),O=c.useCallback(s=>{u(a=>a.map(t=>t.id===s?{...t,status:"waiting",progress:0,error:void 0}:t));const r=setTimeout(()=>{f(s)},1e3);return()=>clearTimeout(r)},[f,n]),A=c.useCallback(()=>{k([])},[]),L=s=>{switch(s){case"waiting":return e.jsx(re,{className:"w-4 h-4"});case"analyzing":return e.jsx(M,{className:"w-4 h-4"});case"repairing":return e.jsx(R,{className:"w-4 h-4"});case"completed":return e.jsx(Y,{className:"w-4 h-4"});case"error":return e.jsx(g,{className:"w-4 h-4"});case"cancelled":return e.jsx(D,{className:"w-4 h-4"})}},W=s=>{switch(s){case"waiting":return"bg-yellow-500";case"analyzing":return"bg-blue-500";case"repairing":return"bg-orange-500";case"completed":return"bg-green-500";case"error":return"bg-red-500";case"cancelled":return"bg-gray-500"}};return e.jsxs("div",{className:"flex-1 p-4 lg:p-6 space-y-6 overflow-x-hidden",children:[e.jsxs("div",{className:"sticky top-0 z-10 bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/60 border-b pb-2 lg:pb-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Video Repair"}),e.jsx("p",{className:"text-muted-foreground",children:"Fix corrupted videos, metadata issues, and playback problems"})]}),e.jsx(x,{variant:"outline",size:"sm",onClick:P,className:"lg:hidden",children:e.jsx(G,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-4 mt-4",children:[e.jsxs(x,{onClick:U,disabled:m.length===0||E,size:"lg",className:m.length>0?"bg-red-500 hover:bg-red-600":"",children:[e.jsx(R,{className:"w-4 h-4 mr-2"}),"Start Repair"]}),e.jsx(x,{variant:"outline",onClick:A,disabled:m.length===0,children:"Clear Files"}),e.jsxs("span",{className:"ml-2 text-muted-foreground text-sm",children:[m.length," file",m.length===1?"":"s"," selected"]})]})]}),e.jsxs("div",{className:"grid gap-6 lg:grid-cols-4",children:[e.jsxs("div",{className:"lg:col-span-3 space-y-6",children:[e.jsxs(w,{children:[e.jsx(y,{children:e.jsxs(C,{className:"flex items-center gap-2",children:[e.jsx(se,{className:"w-5 h-5"}),"Upload Videos to Repair"]})}),e.jsx(j,{children:e.jsx(Q,{onFilesSelected:V})})]}),m.length>0&&e.jsxs(w,{children:[e.jsx(y,{children:e.jsxs(C,{className:"flex items-center gap-2",children:[e.jsx(M,{className:"w-5 h-5"}),"Selected Files Preview"]})}),e.jsx(j,{children:e.jsx("div",{className:"space-y-4",children:m.map((s,r)=>e.jsxs("div",{className:"border rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"font-medium text-xs lg:text-base truncate max-w-[50%]",children:s.name}),e.jsxs("span",{className:"text-xs lg:text-sm text-muted-foreground flex-shrink-0",children:[(s.size/(1024*1024)).toFixed(2)," MB"]})]}),e.jsx(B,{originalFile:s,originalSize:s.size,onDownload:()=>{}})]},`${s.name}-${s.size}-${r}`))})})]}),p.length>0&&e.jsxs(w,{children:[e.jsx(y,{children:e.jsxs(C,{className:"flex items-center gap-2",children:[e.jsx(R,{className:"w-5 h-5"}),"Repair Progress"]})}),e.jsx(j,{children:e.jsx("div",{className:"space-y-4",children:p.map(s=>{const r=s.status==="analyzing"||s.status==="repairing",a=s.status==="completed",t=s.status==="error",l=s.status==="cancelled";return e.jsxs("div",{className:"border rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`p-2 rounded-full ${W(s.status)} text-white`,children:L(s.status)}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium",children:s.file.name}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[s.status==="waiting"&&"Waiting to start...",s.status==="analyzing"&&"Analyzing video file...",s.status==="repairing"&&"Repairing video...",s.status==="completed"&&"Repair completed successfully",s.status==="error"&&"Repair failed",s.status==="cancelled"&&"Repair cancelled"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[a&&e.jsxs(x,{size:"sm",onClick:()=>F(s.id),className:"bg-yellow-500 hover:bg-yellow-600 text-white",children:[e.jsx(ae,{className:"w-4 h-4 mr-1"}),"Download"]}),t&&e.jsxs(x,{size:"sm",variant:"outline",onClick:()=>O(s.id),children:[e.jsx(D,{className:"w-4 h-4 mr-1"}),"Retry"]}),r&&e.jsx(x,{size:"sm",variant:"outline",onClick:()=>J(s.id),children:"Cancel"})]})]}),!t&&!l&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-xs text-muted-foreground",children:[e.jsxs("span",{children:[Math.round(s.progress),"%"]}),r&&s.startTime&&e.jsx("span",{children:"ETA: Calculating..."})]}),e.jsx(X,{value:s.progress,className:"h-2"})]}),t&&s.error&&e.jsx("div",{className:"p-2 bg-red-50 border border-red-200 rounded text-sm text-red-700",children:s.error}),s.issues&&(s.issues.durationMismatch||s.issues.metadataCorruption||s.issues.containerIssues||s.issues.playbackIssues)&&e.jsxs("div",{className:"mt-3",children:[e.jsx("h5",{className:"text-sm font-medium mb-2",children:"Issues Found:"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[s.issues.durationMismatch&&e.jsx(b,{variant:"destructive",children:"Duration Mismatch"}),s.issues.metadataCorruption&&e.jsx(b,{variant:"destructive",children:"Metadata Corruption"}),s.issues.containerIssues&&e.jsx(b,{variant:"destructive",children:"Container Issues"}),s.issues.playbackIssues&&e.jsx(b,{variant:"destructive",children:"Playback Issues"})]})]}),a&&s.repairedSize&&e.jsxs("div",{className:"mt-3 flex items-center gap-4 text-sm text-muted-foreground",children:[e.jsxs("span",{children:["Original: ",(s.originalSize/(1024*1024)).toFixed(2)," MB"]}),e.jsxs("span",{children:["Repaired: ",(s.repairedSize/(1024*1024)).toFixed(2)," MB"]})]}),a&&s.outputBlob&&e.jsx("div",{className:"mt-4",children:e.jsx(B,{originalFile:s.file,compressedBlob:s.outputBlob,originalSize:s.originalSize,compressedSize:s.repairedSize,onDownload:()=>F(s.id)})})]},s.id)})})})]})]}),e.jsx("div",{className:"space-y-6",children:e.jsxs(w,{children:[e.jsx(y,{children:e.jsxs(C,{className:"flex items-center gap-2",children:[e.jsx(R,{className:"w-5 h-5"}),"Repair Settings"]})}),e.jsxs(j,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-2",children:"Repair Type"}),e.jsx("div",{className:"space-y-2",children:[{value:"metadata",label:"Metadata Fix",description:"Fix duration and metadata issues"},{value:"container",label:"Container Repair",description:"Rebuild video container"},{value:"full",label:"Full Repair",description:"Complete video reconstruction"},{value:"extract",label:"Extract & Rebuild",description:"Extract streams and rebuild"}].map(s=>e.jsxs("div",{className:`p-3 border rounded-lg cursor-pointer transition-colors ${S===s.value?"border-video-primary bg-video-primary/5":"border-border hover:border-video-primary/50"}`,onClick:()=>$(s.value),children:[e.jsx("div",{className:"font-medium",children:s.label}),e.jsx("div",{className:"text-sm text-muted-foreground",children:s.description})]},s.value))})]}),e.jsxs("div",{className:"pt-4 border-t",children:[e.jsx("h4",{className:"font-medium mb-2",children:"Common Issues Fixed"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(g,{className:"w-4 h-4 text-orange-500"}),e.jsx("span",{children:"Duration mismatch (metadata vs actual)"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(g,{className:"w-4 h-4 text-orange-500"}),e.jsx("span",{children:"Playback lag and stuttering"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(g,{className:"w-4 h-4 text-orange-500"}),e.jsx("span",{children:"Corrupted video containers"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(g,{className:"w-4 h-4 text-orange-500"}),e.jsx("span",{children:"Broken metadata headers"})]})]})]})]})]})})]})]})}function Ce(){return e.jsxs(q,{children:[e.jsx(K,{}),e.jsxs("div",{className:"flex min-h-screen w-full bg-background",children:[e.jsx(H,{}),e.jsx(te,{})]})]})}export{Ce as default};
